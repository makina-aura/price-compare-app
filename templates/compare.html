{% extends "base.html" %}

{% block title %}価格比較{% endblock %}

{% block content %}

<h2 class="page-title">価格比較（{{ today }}）</h2>


<!-- 商品選択 -->
<div class="card">
  <form method="get" action="/compare">
    <label for="product">商品名を選ぶ</label>
    <select name="product_id" class="select" onchange="this.form.submit()">
      <option value="">選択してください</option>

      {% if products is defined %}
        {% for product in products %}
          <option value="{{ product.id }}"
            {% if selected_product_id is defined and product.id == selected_product_id %}
              selected
            {% endif %}>
            {{ product.name }}
          </option>
        {% endfor %}
      {% endif %}

    </select>
  </form>
</div>

<!-- 比較結果 -->
{% if prices is defined and prices %}

<div class="card">
  <table class="price-table">
    <tr>
      <th>店名</th>
      <th>価格</th>
      <th>差分</th>
    </tr>

    {% for row in prices %}
      <tr {% if row.is_cheapest %}class="best"{% endif %}>
       
<td style="text-align:center; position:relative;">

  <!-- ★＋店名（列中央＝見出し真下） -->
  <a href="/favorite/{{ row.price_id }}" style="display:inline-block;">
    {% if row.is_favorite %}★{% else %}☆{% endif %}
    {{ row.store_name }}
  </a>

  <!-- 削除ボタン（店名と価格の間） -->
  <form method="post"
        action="/delete_price/{{ row.price_id }}"
        onsubmit="return confirm('この行を削除しますか？');"
        style="
          position:absolute;
          right:-45px;
          top:50%;
          transform:translateY(-50%);
          margin:0;
        ">
    <button type="submit">削除</button>
  </form>

</td>







        <td>{{ row.price }}円</td>
        <td>
  {% if row.is_cheapest %}
    <strong>
      最安！｜最大{{ max_diff }}円お得
    </strong>
  {% else %}
    +{{ row.diff }}円
  {% endif %}
</td>

      </tr>
    {% endfor %}

  </table>
</div>



{% else %}

<div class="card">
  <p>商品を選択すると価格を比較できます</p>
</div>

{% endif %}

<div class="card total">
  <p>★ 今日の得した金額 ★</p>
  <strong>
    {% if total_saved_today is defined %}
      {{ total_saved_today }}円
    {% else %}
      0円
    {% endif %}
  </strong>
</div>

<!-- 累計 -->
<div class="card total">
  <p>★ １ヶ月（月初から月末）の得した金額累計 ★</p>
  <strong>
    {% if total_saved is defined %}
      {{ total_saved }}円
    {% else %}
      0円
    {% endif %}
  </strong>
</div>

<a href="/dashboard" class="btn">← ダッシュボードへ戻る</a>

{% endblock %}

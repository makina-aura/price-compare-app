{% extends "base.html" %}

{% block title %}価格比較{% endblock %}

{% block content %}

<h2 align="center">価格比較（{{ today }}）</h2>

<!-- ===== 商品選択エリア ===== -->
<div align="center">

  <p>商品名を選ぶ</p>

  <form method="get" action="/compare">

  <font size="5">
    <select name="product_id">
      <option value="">選択してください</option>
      {% for product in products %}
        <option value="{{ product.id }}"
          {% if selected_product_id == product.id %}selected{% endif %}
        >
          {{ product.name }}
        </option>
      {% endfor %}
    </select>
  </font>

  <br><br>
  <button type="submit">比較する</button>
</form>


</div>

<br>

<!-- ===== 比較結果 ===== -->

<!-- 商品未選択時：中央メッセージ -->
{% if prices is not defined or not prices %}
<div class="card">
  <table align="center" width="100%" cellpadding="12">
    <tr>
      <td align="center">
        商品を選択すると価格を比較できます
      </td>
    </tr>
  </table>
</div>
{% endif %}

<!-- 商品選択時：価格比較テーブル -->
{% if prices is defined and prices %}

<div class="card">
  <table class="price-table">
    <tr>
      <th>店名</th>
      <th>価格</th>
      <th>差分</th>
    </tr>

    {% for row in prices %}
    <tr {% if row.is_cheapest %}class="best"{% endif %}>

      <td style="text-align:center; position:relative;">

        <!-- ★＋店名 -->
        <a href="/favorite/{{ row.price_id }}">
          {% if row.is_favorite %}★{% else %}☆{% endif %}
          {{ row.store_name }}
        </a>

        <!-- 削除ボタン -->
        <form method="post"
              action="/delete_price/{{ row.price_id }}"
              onsubmit="return confirm('この行を削除しますか？');"
              style="
                position:absolute;
                right:-45px;
                top:50%;
                transform:translateY(-50%);
                margin:0;
              ">
          <button type="submit">削除</button>
        </form>

      </td>

      <td align="center">{{ row.price }}円</td>

      <td align="center">
        {% if row.is_cheapest %}
          <strong>最安！｜最大{{ max_diff }}円お得</strong>
        {% else %}
          +{{ row.diff }}円
        {% endif %}
      </td>

    </tr>
    {% endfor %}

  </table>
</div>

{% endif %}

<!-- ===== 今日の合計 ===== -->
<div class="card total">
  <p>★ 今日の得した金額 ★</p>
  <strong>
    {% if total_saved_today is defined %}
      {{ total_saved_today }}円
    {% else %}
      0円
    {% endif %}
  </strong>
</div>

<!-- ===== 月間累計 ===== -->
<div class="card total">
  <p>★ １ヶ月（月初から月末）の得した金額累計 ★</p>
  <strong>
    {% if total_saved is defined %}
      {{ total_saved }}円
    {% else %}
      0円
    {% endif %}
  </strong>
</div>

<a href="/dashboard" class="btn">← ダッシュボードへ戻る</a>

{% endblock %}
